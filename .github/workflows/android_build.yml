name: Android Release build

on: workflow_dispatch

jobs:
  build:
    name: android-release-build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: subosito/flutter-action@v2
        with:
            channel: "stable"
      - name: Generate apk token file
        run: |
            touch assets/config/.env
            echo "AMOSURL = ${{secrets.AMOS_URL}}" > assets/config/.env
            echo "AMOSTOKEN = ${{secrets.AMOS_TOKEN}}" > assets/config/.env
   
      - uses: NiklasLehnfeld/flutter-android-build-action@v1
        id: android-build
        with:
          release: true
          keystore: ${{ secrets.KEYSTORE }}
          keystore-pwd: "${{ secrets.STORE_PASSWORD }}"
          key-pwd: "${{ secrets.KEY_PASSWORD }}"
      - name: Archive APK
        uses: actions/upload-artifact@v2
        with:
          name: release-apk
          path: ${{ steps.android-build.outputs.apk-path }}
      - name: Archive AAB
        uses: actions/upload-artifact@v2
        with:
          name: release-aab
          path: ${{ steps.android-build.outputs.aab-path }}
